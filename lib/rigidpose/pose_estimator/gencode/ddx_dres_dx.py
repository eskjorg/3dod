import numpy as np
import math

def calc_ddx_dres_dx(x, U):
    """
    Inputs:
        Pose parameters x = [alpha, beta, delta, tx, ty, tz] --- (6 x 1) array
        3D-points U --- (3 x N) array
    Outputs:
        ddx_dres_dx --- (2N x 6 x 6) array
    """
    assert x.shape == (1,6)
    assert U.shape[0] == 4
    N = U.shape[1]
    alpha, beta, delta, tx, ty, tz = np.squeeze(x)
    Ux, Uy, Uz = U[0,:], U[1,:], U[2,:]

    t1 = Ux - tx
    t2 = math.cos(beta)
    t3 = t2 ** 2
    t4 = t3 - 2
    t5 = t1 * t4
    t6 = Uy ** 2
    t7 = 3 * t6
    t8 = Uy * ty
    t9 = 6 * t8
    t10 = ty ** 2
    t11 = 3 * t10
    t12 = t1 ** 2
    t13 = -t7 + t9 - t11 + t12
    t15 = math.cos(delta)
    t16 = t15 ** 2
    t17 = t16 * t15
    t20 = Uy - ty
    t21 = math.sin(delta)
    t22 = t20 * t21
    t23 = t6 / 3
    t24 = 0.2e1 / 0.3e1 * t8
    t25 = t10 / 3
    t26 = -t23 + t24 - t25 + t12
    t27 = t3 * t2
    t29 = t22 * t26 * t27
    t31 = math.sin(beta)
    t32 = -ty + Ux - tx + Uy
    t33 = t31 * t32
    t34 = ty + Ux - tx - Uy
    t35 = Uz - tz
    t36 = t34 * t35
    t37 = t36 * t3
    t38 = t33 * t37
    t41 = t22 * t26 * t2
    t43 = t33 * t36
    t44 = 2 * t43
    t47 = tz + Uy - ty - Uz
    t48 = -tz + Uy - ty + Uz
    t49 = t47 * t48
    t50 = t49 * t27
    t52 = t31 * t21
    t53 = t35 * t20
    t54 = t53 * t3
    t55 = t52 * t54
    t57 = 5 * t6
    t58 = 10 * t8
    t59 = 5 * t10
    t60 = Ux ** 2
    t61 = tx * Ux
    t62 = 2 * t61
    t63 = tx ** 2
    t64 = t35 ** 2
    t65 = 2 * t64
    t68 = t52 * t53
    t73 = 2 * t8
    t76 = t20 * (t6 - t73 + t10 - 3 * t64)
    t78 = t76 * t21 * t27
    t81 = t35 * (t6 - t73 + t10 - t64 / 3)
    t83 = t81 * t31 * t3
    t89 = math.cos(alpha)
    t90 = t89 ** 2
    t92 = math.sin(alpha)
    t93 = t2 * t20
    t94 = t31 * t26
    t98 = 4 * t54
    t99 = t13 * t21
    t100 = t31 * t2
    t102 = 2 * t53
    t106 = t21 * t32
    t107 = t106 * t37
    t108 = 2 * t107
    t109 = t6 / 2
    t110 = t10 / 2
    t111 = t64 / 2
    t113 = t20 * (-t109 + t8 - t110 + t60 - t62 + t63 + t111)
    t116 = t106 * t36
    t119 = t49 * t2
    t120 = t52 * t119
    t122 = t53 / 2
    t123 = t54 + t120 / 2 - t122
    t125 = 2 * t1 * t123
    t130 = t2 * t1
    t131 = t3 - 0.1e1 / 0.2e1
    t143 = 4 * t6
    t144 = 8 * t8
    t145 = 4 * t10
    t146 = 2 * tz
    t147 = 2 * Uz
    t150 = (-t146 + Ux - tx + t147) * (t146 + Ux - tx - t147)
    t153 = 2 * t68
    t159 = 2 * t6
    t160 = 4 * t8
    t161 = 2 * t10
    t169 = t2 - 2
    t171 = t2 + 2
    t172 = t1 * t169 * t171
    t173 = t13 * t31
    t174 = t173 * t17
    t176 = t32 * t34
    t179 = 3 * t176 * t35 * t27
    t183 = t2 * t35
    t184 = t176 * t183
    t185 = 6 * t184
    t186 = t22 * t94
    t190 = t21 * t35
    t192 = t190 * t20 * t27
    t193 = 2 * t192
    t195 = t48 * t3
    t196 = t31 * t47 * t195
    t197 = t190 * t93
    t198 = 4 * t197
    t204 = 3 * t81 * t27
    t205 = t52 * t3
    t206 = t76 * t205
    t207 = 3 * t184
    t208 = 3 * t186
    t210 = t90 * t89
    t212 = t3 - 0.4e1 / 0.3e1
    t217 = t99 * t3
    t218 = t31 * t35
    t219 = t218 * t93
    t220 = 4 * t219
    t225 = t113 * t3
    t226 = 2 * t225
    t228 = t36 * t2
    t229 = t52 * t32 * t228
    t230 = 2 * t229
    t231 = t20 * t26
    t235 = t21 * t47
    t236 = t235 * t195
    t237 = 3 * t236
    t238 = 6 * t219
    t246 = t1 * t13
    t247 = t31 * t17
    t248 = t246 * t247
    t253 = 2 * t197
    t260 = t31 * t20
    t261 = t260 * t21
    t262 = t183 + t261
    t263 = t12 * t262
    t264 = 3 * t263
    t269 = t21 * t16
    t273 = 3 * t12 * t20 * t15
    t274 = t12 * t1
    t275 = t21 * t274
    t279 = 0.1e1 / ((t172 * t174 + (-3 * t22 * t94 * t3 - t179 + t185 + 12 * t186) * t16 + 3 * t1 * (t193 + t196 - t198 + t173) * t15 - t204 - t206 - t207 - t208) * t210 - 3 * t92 * (3 * t20 * t212 * t26 * t17 + t1 * (t217 + t220 - 0.4e1 / 0.3e1 * t99) * t16 + (-t226 + t230 + 3 * t231) * t15 + t1 * (t237 - t238 + t99) / 3) * t90 + (3 * t248 + (-t207 - 9 * t186) * t16 - 3 * t1 * (-t253 + (-t159 + t160 - t161 + t12) * t31) * t15 + t264) * t89 - t92 * (3 * t231 * t17 + t246 * t269 - t273 - t275))
    drd11 = ((t5 * t2 * t13 * t17 + (-3 * t29 + 3 * t38 + 6 * t41 - t44) * t16 + t1 * (3 * t50 - 6 * t55 + (-t57 + t58 - t59 + t60 - t62 + t63 + t65) * t2 + 4 * t68) * t15 - t78 + 3 * t83 - t22 * (-t6 + t73 - t10 + t60 - t62 + t63 + t65) * t2 + t43) * t90 + 2 * t92 * (3 * t93 * t94 * t17 + t1 * (t99 * t100 + t102 - t98) * t16 + (-2 * t113 * t100 - t108 + t116) * t15 + t125) * t89 - 2 * t130 * t13 * t131 * t17 + (6 * t29 - 6 * t38 - 3 * t41 + t43) * t16 + t1 * (-6 * t50 + 12 * t55 + (t143 - t144 + t145 + t150) * t2 - t153) * t15 + 2 * t78 - 6 * t83 - t22 * (t159 - t160 + t161 + t150) * t2 + t35 * (t159 - t160 + t161 + t12) * t31) * t279
    t281 = t20 * t17
    t288 = tz / 2
    t289 = Uz / 2
    t298 = 2 * t219
    t299 = t6 - t73 + t10 + t111
    t300 = t21 * t299
    t308 = tz + Ux - tx - Uz
    t309 = -tz + Ux - tx + Uz
    t310 = t308 * t309
    t332 = 4 * t225
    t333 = 4 * t229
    drd12 = ((3 * t4 * t26 * t281 + t1 * (t217 + t220 - 2 * t99) * t16 + (-t226 + t230 + 4 * (-t109 + t8 - t110 + (-t288 + Ux - tx + t289) * (t288 + Ux - tx - t289)) * t20) * t15 + t1 * (t236 - t298 - 2 * t300)) * t90 - 2 * t92 * (t248 + (-t184 - t208) * t16 - t1 * (-t198 + (-t57 + t58 - t59 + t310) * t31) * t15 / 2 + t262 * (-t6 + t73 - t10 + t310) / 2) * t89 - 6 * t231 * t131 * t17 - 2 * t1 * (t217 + t220 - t99 / 2) * t16 + (t332 - t333 - 2 * t113) * t15 - 2 * t1 * (t236 - t298 - t235 * t48 / 2)) * t279
    t343 = t4 * t32
    t344 = t36 * t16
    t346 = t20 * t3
    t347 = t190 * t346
    t348 = 2 * t347
    t351 = (-ty + Uz - tz) * (ty + Uz - tz)
    t352 = t60 - t62 + t6 - t73 + t63 - t351
    t354 = t352 * t31 * t2
    t355 = t190 * t20
    t360 = t60 - t62 + t159 - t160 + t63 + t161
    t361 = t360 * t35
    t362 = t361 * t3
    t363 = t352 * t20
    t364 = t52 * t2
    t365 = t363 * t364
    t366 = t176 * t35
    t369 = t20 * t1
    t370 = t369 * t16
    t371 = t218 * t370
    t374 = t52 * t366
    t380 = t218 * t20
    t401 = t60 - t62 - t7 + t9 + t63 - t11
    t405 = t60 - t62 - t23 + t24 + t63 - t25
    t406 = t405 * t20
    t409 = t406 * t52
    t424 = t21 * t401
    t445 = t31 * t1
    t462 = t21 * t1
    t468 = 0.1e1 / ((t31 * t169 * t171 * t1 * t401 * t17 + (-3 * t406 * t205 - t179 + t185 + 12 * t409) * t16 + 3 * t1 * (t31 * t401 + t193 + t196 - t198) * t15 - t204 - t206 - t207 - 3 * t409) * t210 - 3 * t92 * (3 * t212 * t405 * t281 + t1 * (t424 * t3 + t220 - 0.4e1 / 0.3e1 * t424) * t16 + (-2 * t20 * (t60 - t62 - t109 + t8 + t63 + t351 / 2) * t3 + t230 + 3 * t406) * t15 + t1 * (t237 - t238 + t424) / 3) * t90 + (3 * t445 * t401 * t17 + (-t207 - 9 * t409) * t16 - 3 * t1 * (-t253 + t31 * (t60 - t62 - t159 + t160 + t63 - t161)) * t15 + t264) * t89 - t92 * (t462 * t401 * t16 + 3 * t406 * t17 - t273 - t275))
    drd13 = ((t343 * t344 - t1 * (t348 + t354 - 4 * t355) * t15 + t362 + t365 + t366) * t90 + (4 * t371 + (t363 * t2 + 2 * t374) * t15 + t1 * (t352 * t21 * t2 - 2 * t380)) * t92 * t89 - 2 * t35 * t32 * t34 * t131 * t16 + 2 * t1 * (t348 + t354 - t355) * t15 - 2 * t362 - 2 * t365 + t361) * t468
    t469 = t4 * t35
    t470 = t20 * t16
    t471 = t469 * t470
    t472 = t190 * t3
    t473 = t260 * t2
    t474 = 2 * t190
    t475 = t472 + t473 - t474
    t476 = t1 * t475
    t478 = 2 * t54
    t481 = t1 * t16
    t482 = t218 * t481
    t483 = 2 * t482
    t486 = t2 * t21
    t487 = t486 * t20
    t488 = t487 - t218
    t489 = t488 * t1
    t493 = t131 * t16
    drd14 = ((-t476 * t15 + t120 - t471 + t478 - t53) * t90 + t92 * (t483 + (t119 - t153) * t15 + t489) * t89 + 2 * t53 * t493 + 2 * t1 * (t472 + t473 - t190 / 2) * t15 - t98 - 2 * t120 + t102) * t279
    t503 = t469 * t481
    t505 = t309 * t2
    t506 = t31 * t308 * t505
    t507 = 2 * t355
    t510 = t35 * t3
    t511 = t52 * t93
    t516 = t218 * t470
    t517 = 2 * t516
    t518 = t52 * t35
    t519 = 2 * t518
    t528 = t1 * t35
    t536 = 2 * t1 * (t510 + t511 - t289 + t288)
    t538 = t20 ** 2
    t540 = t60 - t62 + t63 - 3 * t538
    t541 = t540 * t31
    t545 = t60 - t62 + t63 - t538 / 3
    t546 = t545 * t20
    t549 = t546 * t52
    t551 = -3 * t546 * t205 - t179 + t185 + 12 * t549
    t554 = t1 * (t193 + t196 - t198 + t541)
    t557 = 3 * t549
    t563 = t540 * t21
    t564 = t563 * t3
    t566 = t564 + t220 - 0.4e1 / 0.3e1 * t563
    t571 = t20 * (t60 - t62 + t63 - t49 / 2)
    t572 = t571 * t3
    t577 = t237 - t238 + t563
    t584 = t1 * t540
    t585 = t584 * t247
    t588 = -t207 - 9 * t549
    t590 = 2 * t538
    t591 = t60 - t62 + t63 - t590
    t594 = t1 * (t591 * t31 - t253)
    t595 = t594 * t15
    t605 = 0.1e1 / ((t172 * t541 * t17 + 3 * t554 * t15 + t551 * t16 - t204 - t206 - t207 - t557) * t210 - 3 * t92 * (3 * t546 * t212 * t17 + t1 * t566 * t16 + (-2 * t572 + t230 + 3 * t546) * t15 + t1 * t577 / 3) * t90 + (t588 * t16 + t264 + 3 * t585 - 3 * t595) * t89 - t92 * (3 * t546 * t17 + t584 * t269 - t273 - t275))
    drd15 = ((-t503 + (t347 + t506 - t507) * t15 - t1 * (t510 + t511 + Uz - tz)) * t90 - t92 * (t517 + t1 * (t93 + t519) * t15 + t21 * t308 * t505 - t380) * t89 + 2 * t528 * t493 + (-t348 - 2 * t506 + t355) * t15 + t536) * t605
    t606 = t4 * t20
    t610 = t106 * t34 * t3
    t611 = t106 * t34
    t615 = t52 * t183
    t622 = t34 * t16
    t623 = t33 * t622
    t629 = t197 / 2
    drd16 = ((2 * t606 * t481 + (t610 + t219 - 2 * t611) * t15 - t1 * (t346 - t615 - 2 * Uy + 2 * ty)) * t90 - 2 * t92 * (t623 - t1 * (t183 + 4 * t261) * t15 / 2 + t629 - t33 * t34 / 2) * t89 - 4 * t369 * t493 + (-2 * t610 - t298 + t611) * t15 + 2 * t1 * (t346 - t615 - Uy / 2 + ty / 2)) * t468
    t648 = t130 * t540 * t17
    t649 = t546 * t486
    t652 = (-3 * t649 + t43) * t16
    t667 = t563 * t100 + t102 - t98
    t670 = t571 * t100
    t679 = t1 * (t591 * t2 + t153)
    drd22 = ((t648 + t652 + t1 * ((t60 - t62 + t63 + t143 - t144 + t145 + t65) * t2 - t153) * t15 - t488 * (t60 - t62 + t63 + t159 - t160 + t161 + t65)) * t90 - t92 * (3 * t545 * t2 * t260 * t17 + t1 * t667 * t16 + (-t108 - 2 * t670 + t116) * t15 + t125) * t89 + t648 + t652 - t679 * t15 + t488 * t12) * t605
    t683 = t183 * t370
    t684 = 2 * t683
    t685 = t106 * t228
    t686 = t60 - t62 + t6 - t73 + t63 + t10 + t65
    t687 = t686 * t20
    t691 = t53 * t2
    t699 = t100 * t32 * t344
    t700 = t352 * t3
    t701 = t52 * t691
    t702 = 2 * t701
    t707 = t363 * t21 * t3
    t708 = t31 * t360
    t709 = t708 * t183
    t714 = t60 - t62 + t6 - t73 + t63 + t10
    t716 = t260 * t714 - t685
    t720 = t1 * (t52 * t714 + t691)
    drd23 = ((-t684 + (-t687 * t31 - t685) * t15 - t1 * (t686 * t21 * t31 - t691)) * t90 - t92 * (t699 + t1 * (t700 - t702 + t60 - t62 + t6 - t73 + t63 + t10 + t65) * t15 - t707 + t709 - t687 * t21) * t89 - t684 + t716 * t15 + t720) * t468
    t722 = t183 * t481
    t723 = t6 - t73 + t10 + t65
    t727 = t1 * t262
    t731 = t100 * t53 * t16
    t733 = t1 * (t346 - t615 + Uy - ty)
    t735 = t21 * t723
    t739 = t190 * t2
    t740 = t739 + t260
    t742 = t20 * t740 * t15
    drd24 = ((-t722 + (-t723 * t31 + t197) * t15 - t727) * t90 - (t733 * t15 - t236 + t298 - t731 - t735) * t92 * t89 - t722 + t742 + t727) * t279
    t744 = t183 * t470
    t745 = t1 * t740
    t754 = t100 * t528 * t16
    t755 = t310 * t3
    t758 = t22 * t3
    t759 = t218 * t2
    t766 = t20 * t15 + t462
    t768 = -t183 * t15 + t445
    t769 = t766 * t768
    drd25 = ((t744 + t745 * t15 - 2 * t691 + (t60 - t62 + t63 + t65) * t21 * t31) * t90 + (t754 + (t755 - t701 + t60 - t62 + t63 + t65) * t15 - (t758 - t759 + t22) * t1) * t92 * t89 - t769) * t605
    t771 = t2 * t32
    t789 = t1 * t15
    t792 = t176 * t16 - 2 * t22 * t789 - t12
    drd26 = ((t771 * t622 - 2 * t489 * t15 + (t60 - t62 + t63 + t590) * t2 - t153) * t90 - t92 * (2 * t100 * t370 + (t52 * t176 * t2 + t102 - t54) * t15 - t476) * t89 + t2 * t792) * t605
    t795 = t33 * t344
    t797 = t60 - t62 + t6 - t73 + t63 + t10 + t111
    t803 = t797 * t20
    t813 = t54 / 2
    t814 = t797 * t21
    t822 = t714 * t2
    drd33 = ((-2 * t795 - 2 * t1 * (t797 * t2 - t153) * t15 + 2 * t803 * t486 + t43) * t90 + 2 * (-t469 * t370 + (-t107 / 2 + t803 * t100 + t116) * t15 + t1 * (t814 * t100 - t53 + t813)) * t92 * t89 + t795 + 2 * t1 * (t822 - t68) * t15 - 2 * t22 * t822 + t708 * t35) * t468
    t831 = t93 - t518
    drd34 = ((-2 * t1 * t831 * t15 + 2 * t300 * t2 - t380 + t517) * t90 - (t503 + (-2 * t299 * t31 * t2 - t347 + t507) * t15 - t536) * t92 * t89 - t516 + 2 * t1 * (t93 - t518 / 2) * t15 - 2 * t488 * t20) * t279
    t855 = 2 * t60
    t856 = 4 * t61
    t857 = 2 * t63
    t862 = t218 / 2
    t874 = t60 - t62 + t63 + t111
    drd35 = ((t483 + ((t855 - t856 + t857 + t64) * t2 - t153) * t15 - 2 * t1 * (t487 + t862)) * t90 - 2 * t92 * (-t471 / 2 - t1 * (t472 - 2 * t473 - t474) * t15 / 2 - t813 + t52 * t874 * t2 - t122) * t89 - t482 + (-2 * t12 * t2 + t68) * t15 + 2 * t1 * (t487 - t862)) * t605
    t889 = t260 * t481
    t891 = t52 * t176
    t895 = 2 * t260
    t902 = 2 * t22
    t915 = t106 * t34 * t15 - t369 + 2 * t370
    drd36 = ((-4 * t889 + (-t691 - 2 * t891) * t15 - t1 * (t739 - t895)) * t90 + (t343 * t622 - 2 * t1 * (t758 + t759 / 2 - t902) * t15 + (-t855 + t856 - t6 + t73 - t857 - t10) * t3 + t701 + t176) * t92 * t89 + t915 * t31) * t468
    t918 = t218 * t16
    t919 = 4 * t918
    t920 = 2 * t487
    t921 = 2 * t218
    t924 = t92 * t15
    drd44 = ((t919 + t920 - t921) * t90 + 2 * t924 * t475 * t89 - 2 * t918 - t920 + t921) * t279
    t933 = t486 * t1
    drd45 = (((t93 - 4 * t518) * t15 - t933) * t90 - t92 * (t100 * t789 - 2 * t469 * t16 + t146 - t147 + t510 + t511) * t89 + (-t2 * t20 + t519) * t15 + t933) * t468
    t947 = t445 * t16
    t950 = -t2 * t35
    t951 = 2 * t261
    t963 = -t22 * t15 - Ux + t481 + tx
    drd46 = ((-2 * t947 + (t950 + t951) * t15 + t445) * t90 - (t21 * t4 * t789 + t606 * t16 + Uy + t346 - t615 - ty) * t92 * t89 + t963 * t31) * t468
    t979 = t218 * t15 + t130
    drd55 = ((-2 * t2 * t15 * t1 - t919 + t921) * t90 + 2 * t92 * (t100 * t1 - t469 * t15) * t21 * t89 + 2 * t979 * t15) * t605
    t983 = t260 * t16
    t985 = t52 * t789
    drd56 = ((2 * t983 + 2 * t985 + t739 - t260) * t90 - t92 * (t5 * t16 + (-t758 - t759 + t902) * t15 - 2 * t131 * t1) * t89 - t766 * t15 * t31) * t605
    t1004 = t92 * t766
    drd66 = -2 * t89 * ((-t1 * t15 + t22) * t89 + t1004 * t31) * t2 * t468
    t1021 = t6 - t73 + t10 + t12
    t1022 = t20 * t1021
    dsd11 = ((-6 * t26 * t3 * t281 - 2 * t1 * (t99 * t2 + 4 * t380) * t2 * t16 + (t332 - t333 + 2 * t1022) * t15 + 2 * (t1021 * t21 - t236 + t298) * t1) * t89 - 2 * t92 * (t1 * t3 * t174 - 3 * t2 * (t176 * t510 + t231 * t364 - 0.2e1 / 0.3e1 * t366) * t16 - t1 * (t1021 * t31 - 6 * t192 - 3 * t196 + t198) * t15 - t204 - t206 + (t7 - t9 + t11 + t12) * t35 * t2 + t1022 * t52)) * t279
    t1056 = t545 * t92
    t1066 = t1 * t92
    dsd12 = (2 * t2 * (-3 * t1056 * t260 + t584 * t89) * t17 + ((-6 * t649 + t44) * t89 - 2 * t1066 * t667) * t16 + (-2 * t679 * t89 + 4 * (t107 + t670 - t116 / 2) * t92) * t15 + 2 * t1 * (-2 * t92 * t123 + t489 * t89)) / ((-9 * t545 * t212 * t92 * t20 * t90 + t172 * t541 * t210 + 3 * t584 * t31 * t89 - 3 * t1056 * t20) * t17 + (-3 * t1066 * t566 * t90 - t1066 * t563 + t551 * t210 + t588 * t89) * t16 + (3 * t554 * t210 + 6 * t92 * (t572 - t229 - 0.3e1 / 0.2e1 * t546) * t90 - 3 * t594 * t89 + 3 * t92 * t12 * t20) * t15 + (-t204 - t206 - t207 - t557) * t210 - t1066 * t577 * t90 + 3 * t263 * t89 + t92 * t21 * t274)
    dsd13 = ((2 * t716 * t15 - 4 * t683 + 2 * t720) * t89 - 2 * t92 * (t699 + t1 * (t700 - t702 - t60 + t62 - t6 + t73 - t63 - t10) * t15 - t707 + t709 + t22 * t714)) * t468
    t1149 = t346 - t615 - Uy + ty
    dsd14 = ((-2 * t722 + 2 * t742 + 2 * t727) * t89 - 2 * t92 * (t1 * t1149 * t15 + t21 * t538 - t236 + t298 - t731)) * t279
    t1161 = t1 * (t758 - t759 - t22)
    dsd15 = (-2 * t769 * t89 + 2 * (t754 + (t755 - t701 - t12) * t15 - t1161) * t92) * t605
    dsd16 = -2 * t2 * (-t792 * t89 + (2 * t889 + (-t691 + t891) * t15 - t745) * t92) * t605
    t1177 = t3 + 1
    dsd22 = ((3 * t545 * t1177 * t281 + (t564 + t220 + t563) * t1 * t16 + (-2 * t572 + 2 * t229 - 2 * (t60 - t62 + t63 - t109 + t8 - t110 - t64) * t20) * t15 + t1 * (t236 - t298 + t735)) * t89 + (t585 + (-t184 - t557) * t16 - t595 + t263) * t92) * t605
    t1203 = t60 - t62 + t109 - t8 + t63 + t110
    t1209 = t20 * t714
    t1213 = t21 * t714
    dsd23 = ((t1177 * t32 * t344 - t1 * (t348 + t354 + t507) * t15 + t362 + t365 - 2 * t1203 * t35) * t89 - t92 * (2 * t371 + (t1209 * t2 + t374) * t15 + (t1213 * t2 - t380) * t1)) * t468
    t1220 = t1177 * t35
    dsd24 = ((-t1220 * t470 - t1 * (t472 + t473 + t190) * t15 + t478 + t120 - t53) * t89 - (t831 * t20 * t15 + t482 + t489) * t92) * t279
    dsd25 = ((-t1220 * t481 + (t347 + t506 + t355) * t15 - t1 * (t510 + t511 - t147 + t146)) * t89 + t92 * t979 * t766) * t605
    dsd26 = ((2 * t1177 * t20 * t481 + (t610 + t219 + t611) * t15 - t733) * t89 + t92 * t792 * t31) * t605
    dsd33 = ((-2 * t759 * t370 + (-2 * t803 * t3 + 2 * t1209 - t229) * t15 - 2 * t1 * (t814 * t3 - t219 / 2 - t1213)) * t89 + 2 * t92 * (-t771 * t344 / 2 + (t31 * t714 + t197) * t1 * t15 - t361 * t2 / 2 - t52 * t1209)) * t468
    dsd34 = ((-t754 + ((-t159 + t160 - t161 - t64) * t3 + t701 + t590) * t15 - 2 * t1161) * t89 + (t744 + t1 * (t739 + t895) * t15 - 2 * t20 * t262) * t92) * t279
    dsd35 = ((t731 + 2 * (t346 + t615 / 2 - Uy + ty) * t1 * t15 + 2 * t874 * t21 * t3 + t219 - 2 * t21 * t12) * t89 - 2 * (-t722 / 2 + (t31 * t12 + t629) * t15 - t1 * (t183 + t951) / 2) * t92) * t605
    dsd36 = ((t623 + t1 * (t183 - t951) * t15 - t197 - 2 * t1203 * t31) * t89 - t915 * t92) * t2 * t468
    dsd44 = (-2 * t1149 * t15 * t89 + 2 * t92 * (t183 * t16 - t261 + t950)) * t279
    t1339 = (t2 - 1) * (t2 + 1)
    dsd45 = ((2 * t100 * t35 * t16 + t1339 * t789 - t22 + t758 - t759) * t89 + t92 * ((-2 * t739 - t260) * t15 + t445 * t21)) * t468
    dsd46 = -((t983 + t985 + t739 + t260) * t89 + t92 * t963) * t2 * t468
    dsd55 = (-2 * (t100 * t35 * t15 + t1339 * t1) * t21 * t89 + 2 * t924 * t768) * t605
    dsd56 = -((t947 + (t183 - t261) * t15 - 2 * t445) * t89 - t1004 * t15) * t2 * t605
    dsd66 = 2 * t89 * t3 * t766 * t468

    Hr = np.array([
        [drd11, drd12, drd13, drd14, drd15, drd16],
        [[0.]*N, drd22, drd23, drd24, drd25, drd26],
        [[0.]*N, [0.]*N, drd33, drd34, drd35, drd36],
        [[0.]*N, [0.]*N, [0.]*N, drd44, drd45, drd46],
        [[0.]*N, [0.]*N, [0.]*N, [0.]*N, drd55, drd56],
        [[0.]*N, [0.]*N, [0.]*N, [0.]*N, [0.]*N, drd66],
    ])
    Hr = np.moveaxis(Hr, -1, 0) # Last axis is N-dimensional. Put it the first.
    Hs = np.array([
        [dsd11, dsd12, dsd13, dsd14, dsd15, dsd16],
        [[0.]*N, dsd22, dsd23, dsd24, dsd25, dsd26],
        [[0.]*N, [0.]*N, dsd33, dsd34, dsd35, dsd36],
        [[0.]*N, [0.]*N, [0.]*N, dsd44, dsd45, dsd46],
        [[0.]*N, [0.]*N, [0.]*N, [0.]*N, dsd55, dsd56],
        [[0.]*N, [0.]*N, [0.]*N, [0.]*N, [0.]*N, dsd66],
    ])
    Hs = np.moveaxis(Hs, -1, 0) # Last axis is N-dimensional. Put it the first.
    ddx_dres_dx = np.zeros((2*N, 6, 6))
    ddx_dres_dx[::2, :, :] = Hr
    ddx_dres_dx[1::2, :, :] = Hs
    return ddx_dres_dx
